// Job Application Tracker Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Core Models

model Company {
  id          String        @id @default(cuid())
  name        String
  website     String?
  careersUrl  String?
  notes       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  applications Application[]
  contacts     Contact[]

  @@index([name])
}

model Application {
  id              String            @id @default(cuid())
  companyId       String
  company         Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  positionTitle   String
  description     String?
  jobPostingUrl   String?

  status          String @default("NOT_APPLIED")
  appliedDate     DateTime?

  salaryMin       Int?
  salaryMax       Int?
  salaryCurrency  String?           @default("USD")

  resumePath      String            // Required
  coverLetterPath String?           // Optional

  isReferred      Boolean           @default(false)
  referredBy      String?           // Contact ID or name
  referredById    String?
  referredByContact Contact?        @relation("ReferredApplications", fields: [referredById], references: [id])

  applicationDeadline DateTime?
  notes           String?

  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  interviews      Interview[]
  reminders       Reminder[]
  events          Event[]

  @@index([companyId])
  @@index([status])
  @@index([appliedDate])
}

model Contact {
  id              String         @id @default(cuid())
  name            String
  linkedinUrl     String?
  email           String?
  phone           String?

  companyId       String
  company         Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)

  position        String?
  // Status: PENDING_REQUEST, REQUEST_SENT, CONNECTED, REFERRING, REFERRED
  status          String  @default("REQUEST_SENT")

  canRefer        Boolean        @default(false)
  isReferring     Boolean        @default(false)   // Currently in referral process
  hasReferred     Boolean        @default(false)   // Successfully referred

  linkedinRequestSentAt DateTime?  // When LinkedIn request was sent
  linkedinConnectedAt   DateTime?  // When they accepted
  referralRequestedAt   DateTime?  // When you asked for referral
  referralCompletedAt   DateTime?  // When they referred you
  messagedDate          DateTime?  // When contact was messaged

  initialContactDate DateTime    @default(now())
  lastInteractionDate DateTime?

  notes           String?
  conversationNotes String?

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  referredApplications Application[] @relation("ReferredApplications")
  interactions    Interaction[]
  events          Event[]

  @@index([companyId])
  @@index([status])
  @@index([canRefer])
  @@index([isReferring])
  @@index([hasReferred])
}

model Interaction {
  id          String   @id @default(cuid())
  contactId   String
  contact     Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)

  type        String
  notes       String?
  interactionDate DateTime @default(now())

  createdAt   DateTime @default(now())

  @@index([contactId])
  @@index([interactionDate])
}

model Event {
  id              String         @id @default(cuid())

  // Type of event: INTERVIEW, NETWORKING_CALL, REMINDER, TODO
  type            String         @default("REMINDER")

  // Relations - optional, can be linked to application or contact
  applicationId   String?
  application     Application?   @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  contactId       String?
  contact         Contact?       @relation(fields: [contactId], references: [id], onDelete: Cascade)

  // Basic info
  title           String
  description     String?
  scheduledDate   DateTime
  duration        Int?           // in minutes

  // Interview-specific fields
  round           Int?           // 1, 2, 3, etc. (for interviews)
  interviewers    String?        // Comma-separated names
  location        String?        // "Zoom", "Google Meet", "In-person", etc.
  meetingLink     String?

  // Status tracking
  status          String         @default("PENDING") // PENDING, COMPLETED, CANCELLED, RESCHEDULED
  isCompleted     Boolean        @default(false)
  completedAt     DateTime?

  // Feedback and notes
  feedback        String?
  notes           String?

  // Outcome tracking - what happened after the event
  outcome         String?        // The result/outcome of the event
  nextSteps       String?        // JSON array of {text: string, completed: boolean}
  nextStepsDueDate DateTime?     // Due date for next steps

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([type])
  @@index([applicationId])
  @@index([contactId])
  @@index([scheduledDate])
  @@index([isCompleted])
  @@index([status])
}

// Keep old models for migration purposes - will be removed after data migration
model Interview {
  id              String         @id @default(cuid())
  applicationId   String
  application     Application    @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  round           Int            // 1, 2, 3, etc.
  title           String         // "Phone Screen", "Technical Round", "HR Round"
  interviewDate   DateTime
  duration        Int?           // in minutes

  interviewers    String?        // Comma-separated or JSON
  location        String?        // "Zoom", "Google Meet", "In-person"
  meetingLink     String?

  status          String @default("SCHEDULED")
  feedback        String?
  notes           String?

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([applicationId])
  @@index([interviewDate])
}

model Reminder {
  id              String         @id @default(cuid())
  applicationId   String?
  application     Application?   @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  title           String
  description     String?
  dueDate         DateTime

  isCompleted     Boolean        @default(false)
  completedAt     DateTime?

  type            String   @default("FOLLOW_UP")

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([dueDate])
  @@index([isCompleted])
}

model Task {
  id              String         @id @default(cuid())
  title           String
  notes           String?
  dueDate         DateTime
  isCompleted     Boolean        @default(false)
  completedAt     DateTime?

  parentTaskId    String?
  parentTask      Task?          @relation("TaskSubtasks", fields: [parentTaskId], references: [id], onDelete: Cascade)
  subtasks        Task[]         @relation("TaskSubtasks")

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([dueDate])
  @@index([isCompleted])
  @@index([parentTaskId])
}

model EmailTemplate {
  id          String   @id @default(cuid())
  name        String
  subject     String
  body        String
  category    String

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
}

model LearningItem {
  id              String         @id @default(cuid())

  // Type: SKILL, PROJECT, CONCEPT, COURSE
  type            String         @default("CONCEPT")

  // Basic info
  title           String
  description     String?

  // Learning resources
  resourceUrl     String?        // YouTube, course link, documentation
  additionalLinks String?        // JSON array of additional resources

  // Category/tags for organization
  category        String?        // "Frontend", "Backend", "DevOps", "Data Science", etc.
  tags            String?        // Comma-separated tags

  // Progress tracking
  status          String         @default("TO_LEARN") // TO_LEARN, IN_PROGRESS, COMPLETED, ON_HOLD
  priority        String         @default("MEDIUM")   // LOW, MEDIUM, HIGH
  progress        Int            @default(0)          // 0-100 percentage

  // Timeline
  targetDate      DateTime?      // When you want to complete this
  startedAt       DateTime?
  completedAt     DateTime?

  // Notes and learnings
  notes           String?        // Your notes while learning
  keyTakeaways    String?        // What you learned

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([type])
  @@index([status])
  @@index([priority])
  @@index([category])
}

// Resource Management Models

model Resource {
  id              String         @id @default(cuid())

  // Basic info
  title           String
  description     String?
  url             String?        // YouTube link, GitHub link, website, etc.
  type            String         // "youtube", "github", "article", "documentation", "course", "other"

  // Organization
  category        String?        // "Frontend", "Backend", "Interview Prep", "DSA", etc.
  tags            String?        // Comma-separated tags

  // Parent-child relationship for nested resources
  parentId        String?
  parent          Resource?      @relation("ResourceSubResources", fields: [parentId], references: [id], onDelete: Cascade)
  subResources    Resource[]     @relation("ResourceSubResources")

  // Tracking
  isCompleted     Boolean        @default(false)
  isFavorite      Boolean        @default(false)
  notes           String?

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([type])
  @@index([category])
  @@index([parentId])
  @@index([isCompleted])
  @@index([isFavorite])
}

// Enums

